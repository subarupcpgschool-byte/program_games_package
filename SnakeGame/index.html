<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>Snake Game</title>
    <style>
        body {
            background: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        canvas {
            background: #000;
            border: 2px solid #0f0;
        }
    </style>
</head>

<body>

    <canvas id="game" width="400" height="400"></canvas>

    <script>
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");

        const gridSize = 20;
        const tileCount = canvas.width / gridSize;

        let snake = [
            { x: 10, y: 10 }
        ];

        let dx = 1;
        let dy = 0;

        let food = randomFood();
        let invisible = false;

        function gameLoop() {
            if (invisible) {
                return;
            }
            moveSnake();
            if (isGameOver()) {
                invisible = true;
                alert("ゲームオーバー");
                location.reload();
                return;
            }
            draw();
        }

        function stopSnake() {
            const head = {
                x: 10,
                y: 10
            };
        }
        function moveSnake() {
            const head = {
                x: snake[0].x + dx,
                y: snake[0].y + dy
            };

            snake.unshift(head);

            // エサを食べたか
            if (head.x === food.x && head.y === food.y) {
                food = randomFood();
            } else {
                snake.pop();
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // スネーク
            ctx.fillStyle = "#0f0";
            snake.forEach(part => {
                ctx.fillRect(
                    part.x * gridSize,
                    part.y * gridSize,
                    gridSize,
                    gridSize
                );
            });

            // エサ
            ctx.fillStyle = "red";
            ctx.fillRect(
                food.x * gridSize,
                food.y * gridSize,
                gridSize,
                gridSize
            );
        }

        function randomFood() {
            return {
                x: Math.floor(Math.random() * tileCount),
                y: Math.floor(Math.random() * tileCount)
            };
        }

        function isGameOver() {
            const head = snake[0];

            // 壁
            if (
                head.x < 0 ||
                head.y < 0 ||
                head.x >= tileCount ||
                head.y >= tileCount
            ) {
                return true;
            }

            // 自分の体
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    return true;
                }
            }
            return false;
        }

        document.addEventListener("keydown", e => {
            switch (e.key) {
                case "ArrowUp":
                    if (dy === 0) { dx = 0; dy = -1; }
                    break;
                case "ArrowDown":
                    if (dy === 0) { dx = 0; dy = 1; }
                    break;
                case "ArrowLeft":
                    if (dx === 0) { dx = -1; dy = 0; }
                    break;
                case "ArrowRight":
                    if (dx === 0) { dx = 1; dy = 0; }
                    break;
            }
        });

        setInterval(gameLoop, 150);
    </script>

</body>

</html>